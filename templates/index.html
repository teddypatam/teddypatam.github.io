{% extends 'base.html' %}
{% block content %}
<section class="intro">
	<div class="social-icons intro-social">
		{% for network, url in strings.store_links.items() %}
		<a href="{{ url }}" target="_blank" rel="noopener noreferrer" title="{{ network }}">
			<img src="https://www.google.com/s2/favicons?domain={{ url.split('/')[2] }}&sz=32" alt="{{ url }}">
		</a>
		{% endfor %}
	</div>
    <div class="intro-content">
        <div class="intro-icon">ðŸ§¸</div>
        <p class="intro-text">{{ strings.intro }}</p>
        <div class="intro-decoration">
			<div class="sparkle sparkle-1" aria-hidden="true">
				<svg class="sparkle-icon" viewBox="0 0 24 24" width="28" height="28" fill="none">
					<path d="M12 2.5l2.1 5.4 5.6.5-4.2 3.6 1.2 5.4L12 15.6 7.3 17.4l1.2-5.4L4.3 8.4l5.6-.5z" fill="currentColor"/>
				</svg>
			</div>
			<div class="sparkle sparkle-2" aria-hidden="true">
				<svg class="sparkle-icon" viewBox="0 0 24 24" width="34" height="34" fill="none">
					<path d="M12 2.5l2.1 5.4 5.6.5-4.2 3.6 1.2 5.4L12 15.6 7.3 17.4l1.2-5.4L4.3 8.4l5.6-.5z" fill="currentColor"/>
				</svg>
			</div>
			<div class="sparkle sparkle-3" aria-hidden="true">
				<svg class="sparkle-icon" viewBox="0 0 24 24" width="24" height="24" fill="none">
					<path d="M12 4.2l1.4 3.3 3.5.4-2.7 2.3.8 3.5L12 11.8 9 13.7l.8-3.5L7.1 7.9l3.5-.4z" fill="currentColor"/>
				</svg>
			</div>
        </div>
    </div>
</section>

{% if groups and groups|length > 0 %}
<section class="filters">
	<div class="segmented" role="tablist" aria-label="Filter by group">
		<button class="segmented-btn active" data-filter="all" role="tab" aria-selected="true">{{ strings.all }} ({{
			total_count }})</button>
		{% for g in groups %}
		<button class="segmented-btn" data-filter="{{ g }}" role="tab" aria-selected="false">{{ g }} ({{
			group_counts.get(g, 0) }})</button>
		{% endfor %}
	</div>
</section>
{% endif %}

<section class="grid">
	<ul class="card-grid" role="list" id="bear-grid">
		{% for bear in bears %}
		<li class="card" data-group="{{ bear.group if bear.group else '' }}">
			<a class="card-link"
				href="{{ url_for('bear_detail', lang=lang, slug=bear.slug if bear.slug else bear['slug']) }}">
				<div class="card-media">
					{% if bear.pinned %}
					<div class="pin-icon" title="Pinned item">
						<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
							<path d="M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z" />
						</svg>
					</div>
					{% endif %}
					<img src="{{ url_for('static', filename=bear.cover_image) }}" alt="{{ bear.name }}" loading="lazy">
				</div>
				<div class="card-body">
					<h3 class="card-title">{{ bear.name }}</h3>
					<p class="card-summary">{{ bear.summary }}</p>
				</div>
			</a>
			{% if bear.store_links %}
			<div class="card-footer">
				{% for title, link in bear.store_links.items() %}
				<a href="{{ link }}" class="store-button" target="_blank" rel="noopener">{{ title }}</a>
				{% endfor %}
			</div>
			{% endif %}
		</li>
		{% endfor %}
	</ul>
</section>

<script>
	(function () {
		var segmented = document.querySelector('.segmented');
		if (!segmented) return;
		var buttons = Array.prototype.slice.call(segmented.querySelectorAll('.segmented-btn'));
		var cards = Array.prototype.slice.call(document.querySelectorAll('#bear-grid .card'));
		function applyFilter(val) {
			cards.forEach(function (card) {
				var g = card.getAttribute('data-group') || '';
				var show = (val === 'all') || (g === val);
				card.style.display = show ? '' : 'none';
			});
		}
		buttons.forEach(function (btn) {
			btn.addEventListener('click', function () {
				buttons.forEach(function (b) { b.classList.remove('active'); b.setAttribute('aria-selected', 'false'); });
				btn.classList.add('active');
				btn.setAttribute('aria-selected', 'true');
				applyFilter(btn.getAttribute('data-filter'));
			});
		});
	})();
</script>
{% endblock %}